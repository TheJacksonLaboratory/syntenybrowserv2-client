<div *ngIf="genomeData" id="genome-view-container">
  <div class="clr-row clr-justify-content-end">
    <button class="btn" (click)="filenameModalOpen = true">
      <clr-icon shape="download"></clr-icon> Download
    </button>
  </div>
  <svg id="genome-view-svg" [attr.viewBox]="'0 0 ' + width + ' ' + width"
       preserveAspectRatio="xMinYMin meet">
    <rect [attr.width]="width" [attr.height]="width" fill="#FFF"></rect>
    <!-- Referemce plot -->
    <g id="reference-plot" font-family="Metropolis, sans-serif" font-size="12"
       [attr.transform]="getCenter()">
      <!-- Reference genome synteny blocks -->
      <g id="ref-blocks">
        <path *ngFor="let blk of genomeData"
              [attr.d]="getBlockBandPath(refRadii, refGMap, blk)"
              [attr.fill]="blk.getColor()"
              (click)="renderChordMapForChr(blk.refChr)">
        </path>
      </g>

      <!-- Reference chromosome bands (transparent containers) -->
      <g id="ref-bands">
        <path *ngFor="let chr of getChromosomes(ref.genome)"
              stroke="#000" stroke-width="0.25" fill="transparent"
              [attr.d]="getChrBandPath(refRadii, refGMap, chr, ref.genome)"
              (click)="renderChordMapForChr(chr)"
              (mouseenter)="getTooltipContent(chr, ref)"
              (mouseleave)="hideTooltip()">
        </path>
      </g>

      <!-- Reference genome labels -->
      <g id="ref-labels">
        <text *ngFor="let chr of getChromosomes(ref.genome)" text-anchor="middle"
              [attr.transform]="getRefLabelPos(chr, refGMap)"
              (click)="renderChordMapForChr(chr)">
          {{ chr }}
        </text>
      </g>

      <!-- Blocks containing selected features -->
      <g *ngIf="featureBlocks" id="feature-blocks">
        <path *ngFor="let blk of featureBlocks"
              [attr.d]="getBlockBandPath(featureRadii, refGMap, blk)"
              [attr.fill]="blk.getColor()"
              (click)="renderChordMapForChr(blk.refChr)">
        </path>
      </g>
    </g>

    <g *ngIf="!refChr" id="comparison-plot"
       font-family="Metropolis, sans-serif" font-size="12"
       [attr.transform]="getCenter()">
      <!-- Comparison genome bands -->
      <g id="comp-bands">
        <path *ngFor="let chr of getChromosomes(comp.genome)"
              stroke="#000" stroke-width="0.25"
              [attr.d]="getChrBandPath(compRadii, compGMap, chr, comp.genome)"
              [attr.fill]="getChrColor(chr)"
              (mouseenter)="getTooltipContent(chr, comp)"
              (mouseleave)="hideTooltip()">
        </path>
      </g>

      <!-- Comparison genome labels -->
      <g id="comp-labels">
        <text *ngFor="let chr of getChromosomes(comp.genome)" text-anchor="middle"
              [attr.transform]="getCompLabelPos(chr, compGMap)">
          {{ chr }}
        </text>
      </g>
    </g>

    <g *ngIf="refChr" id="comparison-plot"
       font-family="Metropolis, sans-serif" font-size="12"
       [attr.transform]="getCenter()">
      <!-- Reference chromosome-->
      <g id="ref-band">
        <!-- Reference chromosome band (transparent container) -->
        <path stroke="#000" stroke-width="0.25" fill="transparent"
              [attr.d]="getInnerRefBlockBandPath()">
        </path>

        <!-- Reference chromosome syntenic bands -->
        <path *ngFor="let blk of refChr.blocks"
              [attr.d]="getBlockBandPath(compRadii, compGMap, blk, true)"
              [attr.fill]="blk.getColor()">
        </path>
      </g>

      <!-- Comparison genome bands -->
      <g id="comp-bands">
        <path *ngFor="let chr of getChromosomes(comp.genome)" class="inner"
              [attr.d]="getChrBandPath(compRadii, compGMap, chr, comp.genome)"
              [attr.fill]="getChrColor(chr)"
              (mouseenter)="getTooltipContent(chr, comp)"
              (mouseleave)="hideTooltip()">
        </path>
      </g>

      <!-- Mapping chords from reference to comparison -->
      <g id="chord-mapping">
        <path *ngFor="let blk of refChr.blocks" stroke-width="0.3"
              [attr.d]="getChordPath(compRadii.ringInner, compGMap, blk)"
              [attr.fill]="blk.getColor()"
              [attr.stroke]="blk.getColor()">
        </path>
      </g>

      <!-- Comparison genome labels -->
      <g id="comp-labels">
        <text *ngFor="let chr of getChromosomes(tempCompGenome)" text-anchor="middle"
              [attr.transform]="getCompLabelPos(chr, compGMap, true)">
          {{ chr }}
        </text>
      </g>
    </g>

    <!-- Tooltip Content -->
    <g *ngIf="tooltipContent" [ngStyle]="{'transform': 'translate(50%, 50%)'}">
      <text id="tt-title" text-anchor="middle">
        {{ tooltipContent.title }}
      </text>
      <text id="tt-chr" text-anchor="middle" [attr.dy]="13">
        Chr {{ tooltipContent.chr }}
      </text>
    </g>
  </svg>
</div>

<clr-modal [(clrModalOpen)]="filenameModalOpen">
  <h3 class="modal-title">Download SVG</h3>
  <div class="modal-body">
    <h4>Choose a Filename</h4>
    <div class="clr-row bottom-1 left-1">
      <p><i>Downloaded files will be in PNG format</i></p>
      <div class="clr-col-7">
        <clr-input-container style="margin-top: 0.4rem;">
          <label for="filename-input"></label>

          <input id="filename-input" clrInput placeholder="Name the file (.png)"
                 [(ngModel)]="downloadFilename">
        </clr-input-container>
      </div>
      <div class="clr-col">
        <button class="btn" [disabled]="downloadFilename === ''"
                (click)="download()">
          OK
        </button>
      </div>
    </div>
  </div>
</clr-modal>
